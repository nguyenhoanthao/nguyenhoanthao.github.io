<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.133.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Kiểm tra WebSocket APIs bằng wscat :: Amazon API Gateway</title>

    
    <link href="/css/nucleus.css?1726994205" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1726994205" rel="stylesheet">
    <link href="/css/hybrid.css?1726994205" rel="stylesheet">
    <link href="/css/featherlight.min.css?1726994205" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1726994205" rel="stylesheet">
    <link href="/css/auto-complete.css?1726994205" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1726994205" rel="stylesheet">
    <link href="/css/theme.css?1726994205" rel="stylesheet">
    <link href="/css/hugo-theme.css?1726994205" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1726994205" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1726994205"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/vi/lab3/3-testing-the-websocket-using-wscat/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1726994205"></script>
<script type="text/javascript" src="/js/auto-complete.js?1726994205"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/nguyenhoanthao.github.io\/\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1726994205"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/lab1/" title="REST APIs tích hợp Lambda, Mock và AWS Service" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab1/">
          <b>1. </b>REST APIs tích hợp Lambda, Mock và AWS Service
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/lab1/1-setting-up-sns/" title="Thiết lập SNS" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab1/1-setting-up-sns/">
          <b>1.1 </b>Thiết lập SNS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/lab1/2-create-the-lambda/" title="Tạo Lambda" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab1/2-create-the-lambda/">
          <b>1.2 </b>Tạo Lambda
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/lab1/3-create-the-api/" title="Tạo API" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab1/3-create-the-api/">
          <b>1.3 </b>Tạo API
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/lab1/4-testing-the-api/" title="Thử nghiệm API" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab1/4-testing-the-api/">
          <b>1.4 </b>Thử nghiệm API
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/lab1/5-cleaning-up/" title="Dọn dẹp tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab1/5-cleaning-up/">
          <b>1.5 </b>Dọn dẹp tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/lab2/" title="HTTP APIs tích hợp Lambda và Postman" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab2/">
          <b>2. </b>HTTP APIs tích hợp Lambda và Postman
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/lab2/1-setting-up-api-and-creating-lambda-function/" title="Thiết lập API và tạo hàm Lambda" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab2/1-setting-up-api-and-creating-lambda-function/">
          <b>2.1 </b>Thiết lập API và tạo hàm Lambda
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/lab2/2-http-api-experiment-with-postman/" title="Thực nghiệm HTTP APIs dùng Postman" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab2/2-http-api-experiment-with-postman/">
          <b>2.2 </b>Thực nghiệm HTTP APIs dùng Postman
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/lab2/3-cleaning-up/" title="Dọn dẹp tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab2/3-cleaning-up/">
          <b>2.3 </b>Dọn dẹp tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/lab3/" title="WebSocket APIs tích hợp Lambda và WSCAT " class="dd-item 
        parent
        
        
        ">
      <a href="/vi/lab3/">
          <b>3. </b>WebSocket APIs tích hợp Lambda và WSCAT 
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/lab3/1-setting-up-api-gateway/" title="Thiết lập Cổng API và tạo hàm Lambda" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab3/1-setting-up-api-gateway/">
          <b>3.1 </b>Thiết lập Cổng API và tạo hàm Lambda
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/lab3/2-lambda-function-code/" title="Mã hàm Lambda" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab3/2-lambda-function-code/">
          <b>3.2 </b>Mã hàm Lambda
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/lab3/3-testing-the-websocket-using-wscat/" title="Kiểm tra WebSocket APIs bằng wscat" class="dd-item 
        
        active
        
        ">
      <a href="/vi/lab3/3-testing-the-websocket-using-wscat/">
          <b>3.3 </b>Kiểm tra WebSocket APIs bằng wscat
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/lab3/4-cleaning-up/" title="Dọn dẹp tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="/vi/lab3/4-cleaning-up/">
          <b>3.4 </b>Dọn dẹp tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - Nhóm FB</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="http://nguyenhoanthao.github.io/lab3/3-testing-the-websocket-using-wscat/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="http://nguyenhoanthao.github.io/vi/lab3/3-testing-the-websocket-using-wscat/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830891&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>05-09-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i>
                <a href="https://www.facebook.com/hoanthao.nguyen.98"  style="color:orange">Nguyễn Hoàn Thảo</a>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/vi/'>Amazon API Gateway</a> > <a href='/vi/lab3/'>WebSocket APIs tích hợp Lambda và WSCAT </a> > Kiểm tra WebSocket APIs bằng wscat
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Kiểm tra WebSocket APIs bằng wscat
            </h1>
          

        



	<ol>
<li>
<p><strong>Cài đặt wscat</strong></p>
<ul>
<li>Cài đặt <strong>wscat</strong> ở terminal.</li>
<li>Câu lệnh: <code>npm install -g wscat</code>.
<img alt="133" src="/images/133.png"></li>
<li>Chuyển hướng đến tab <strong>API gateway</strong>, copy <strong>WebSocket URL</strong>.
<img alt="134" src="/images/134.png"></li>
<li>Bây giờ tại terminal chúng ta sẽ mở 2 cửa sổ(cửa sổ 1 và cửa sổ 2).</li>
<li>Tại cửa sổ 1 chúng ta sẽ gõ lệnh: <code>wscat -c wss://2ur7m6qwv6.execute-api.us-east-1.amazonaws.com/production/</code>

<div class="notices note" ><p>Bạn cần thay thế WebSocket của bạn đã copy ở buớc truớc.</p>
</div>
</li>
<li>Sau đó nhấn <strong>Enter</strong>.</li>
<li>Chúng ta đã kết nối đến WebSocket thành công.
<img alt="135" src="/images/135.png"></li>
<li>Tương tự với cửa sổ 2.
<img alt="136" src="/images/136.png"></li>
<li>Từ cửa sổ 1 gõ một JSON đến Socket: <code>{&quot;action&quot; : &quot;sendPublic&quot;}</code></li>
<li>Ta sẽ nhận được phản hổi:
<img alt="137" src="/images/137.png"></li>
<li>Từ cửa sổ 2 gõ một JSON đến Socket: <code>{&quot;action&quot; :  &quot;sendPrivate&quot;}</code></li>
<li>Ta sẽ nhận được phản hồi:
<img alt="138" src="/images/138.png"></li>
</ul>
<p>Có thể thấy khi một user gửi tin nhắn đến Socket thì chỉ người dùng đó nhận được phản hồi, vì vậy chúng ta sẽ cập nhật code hàm Lambda để khi một người dùng gửi tin nhắn thì các người dùng khác đều nhận được phản hồi.</p>
</li>
<li>
<p><strong>Cập nhật code hàm Lambda</strong></p>
<p>Chúng ta sẽ dùng đoạn mã dưới đây:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>  <span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ApiGatewayManagementApiClient</span>, <span style="color:#a6e22e">PostToConnectionCommand</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@aws-sdk/client-apigatewaymanagementapi&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ENDPOINT</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2ur7m6qwv6.execute-api.us-east-1.amazonaws.com/production&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    QUAN TRỌNG: xóa &#39;https://&#39; và &#39;@connections&#39; khỏi URL kết nối mà bạn sao chép qua
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    ví dụ:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">      Connection URL https://xxxxxxxxxxx/execute-api.us-east-1.amazonaws.com/production/@connections
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    sang:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">      ENDPOINT = &#39;xxxxxxxxxxx/execute-api.us-east-1.amazonaws.com/production/&#39;  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">client</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">ApiGatewayManagementApiClient</span>({ <span style="color:#a6e22e">endpoint</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`https://</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">ENDPOINT</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">names</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  * Gửi tin nhắn tới một client qua Connection ID
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sendToOne</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">body</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">command</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PostToConnectionCommand</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ConnectionId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">id</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">Data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Buffer</span>.<span style="color:#a6e22e">from</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">body</span>)),
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">command</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">`Error sending message to </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">:`</span>, <span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  * Gửi tin nhắn tới tất cả các client
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">  */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sendToAll</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">ids</span>, <span style="color:#a6e22e">body</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">all</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">ids</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">i</span> =&gt; <span style="color:#a6e22e">sendToOne</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">body</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Promise.<span style="color:#a6e22e">all</span>(<span style="color:#a6e22e">all</span>);
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">handler</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">event</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">requestContext</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">connectionId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">requestContext</span>.<span style="color:#a6e22e">connectionId</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">routeKey</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">requestContext</span>.<span style="color:#a6e22e">routeKey</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">body</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">body</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">body</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">body</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Failed to parse event body:&#39;</span>, <span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Xử lý các action cụ thể dựa trên body.action
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">routeKey</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;$connect&#39;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`New connection: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">connectionId</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;$disconnect&#39;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">sendToAll</span>(Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">names</span>), { <span style="color:#a6e22e">systemMessage</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">names</span>[<span style="color:#a6e22e">connectionId</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> has left the chat`</span> });
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">delete</span> <span style="color:#a6e22e">names</span>[<span style="color:#a6e22e">connectionId</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">sendToAll</span>(Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">names</span>), { <span style="color:#a6e22e">members</span><span style="color:#f92672">:</span> Object.<span style="color:#a6e22e">values</span>(<span style="color:#a6e22e">names</span>) });
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Disconnected: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">connectionId</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;setName&#39;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">names</span>[<span style="color:#a6e22e">connectionId</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">sendToAll</span>(Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">names</span>), { <span style="color:#a6e22e">members</span><span style="color:#f92672">:</span> Object.<span style="color:#a6e22e">values</span>(<span style="color:#a6e22e">names</span>) });
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">sendToAll</span>(Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">names</span>), { <span style="color:#a6e22e">systemMessage</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">names</span>[<span style="color:#a6e22e">connectionId</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74"> has joined the chat`</span> });
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;sendPublic&#39;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">sendToAll</span>(Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">names</span>), { <span style="color:#a6e22e">publicMessage</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">names</span>[<span style="color:#a6e22e">connectionId</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">message</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> });
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;sendPrivate&#39;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">to</span> <span style="color:#f92672">=</span> Object.<span style="color:#a6e22e">keys</span>(<span style="color:#a6e22e">names</span>).<span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">key</span> =&gt; <span style="color:#a6e22e">names</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">===</span> <span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">to</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">to</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">sendToOne</span>(<span style="color:#a6e22e">to</span>, { <span style="color:#a6e22e">privateMessage</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">names</span>[<span style="color:#a6e22e">connectionId</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">message</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span> });
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">sendToOne</span>(<span style="color:#a6e22e">connectionId</span>, { <span style="color:#a6e22e">errorMessage</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`User </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">to</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> not found.`</span> });
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Unhandled route: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">routeKey</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">statusCode</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#e6db74">&#39;Message processed&#39;</span>),
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">response</span>;
</span></span><span style="display:flex;"><span>  };
</span></span></code></pre></div><p>Chức năng gửi tin nhắn cho tất cả các client trong đoạn mã mới được thực hiện qua hàm sendToAll. Hàm này nhận một danh sách các Connection ID (danh sách ids), đại diện cho tất cả các client hiện đang kết nối, cùng với nội dung tin nhắn (body) cần gửi.</p>
<ul>
<li>
<p>Nhấn <strong>Deploy</strong> để cập nhật.
<img alt="139" src="/images/139.png"></p>
</li>
<li>
<p>Thông báo đã cập nhật thành công.
<img alt="140" src="/images/140.png"></p>
</li>
</ul>
</li>
<li>
<p><strong>Kiểm tra lại với hàm Lambda vừa cập nhật</strong></p>
<ul>
<li>
<p>Tiếp tục mở 2 cửa sổ terminal kết nối với websocket.</p>
</li>
<li>
<p>Ở cửa sổ 1:</p>
<ul>
<li><code>{&quot;action&quot;: &quot; setName &quot;, &quot; name &quot;: &quot; bob &quot;}</code></li>
</ul>
</li>
<li>
<p>Ta nhận đuợc phản hồi:
<img alt="141" src="/images/141.png"></p>
</li>
<li>
<p>Ở cửa sổ 2:</p>
<ul>
<li><code>{&quot;action&quot;: &quot; setName &quot;, &quot; name &quot;: &quot; alice &quot;}</code></li>
</ul>
</li>
<li>
<p>Ta nhận được phản hồi:</p>
<p><img alt="142" src="/images/142.png"></p>
</li>
<li>
<p>Bây giờ chúng ta qua cửa sổ 1 sẽ thấy phản hồi:</p>
<p><img alt="143" src="/images/143.png"></p>
</li>
<li>
<p>Tiếp tục ở cửa sổ 2:</p>
<ul>
<li><code>{&quot;action&quot;: &quot;sendPublic&quot;, &quot;message&quot;: &quot;Hello World!&quot;}</code></li>
</ul>
<p><img alt="144" src="/images/144.png"></p>
</li>
<li>
<p>Qua cửa sổ 1 kiểm tra:</p>
<p><img alt="145" src="/images/145.png"></p>
</li>
<li>
<p>Qua cửa sổ 2:</p>
<ul>
<li><code>{&quot;action&quot;: &quot;sendPrivate&quot;, &quot;message&quot;: &quot;this is private&quot;, &quot;to&quot;: &quot;bob&quot;}</code></li>
</ul>
<p><img alt="146" src="/images/146.png"></p>
</li>
<li>
<p>Qua cửa sổ 1 kiểm tra:</p>
<p><img alt="147" src="/images/147.png"></p>
</li>
<li>
<p>Bây giờ hãy ngắt kết nối ở cửa sổ 2:</p>
<ul>
<li><code>Ctrl + C</code></li>
</ul>
<p><img alt="148" src="/images/148.png"></p>
</li>
<li>
<p>Lúc này ở Terminal ở cửa sổ 1 sẽ thông báo:</p>
<p><img alt="149" src="/images/149.png"></p>
</li>
</ul>
</li>
</ol>
<p>Vừa rồi là một chuỗi thao tác với hai cửa sổ khác nhau liên quan đến việc gửi tin nhắn công khai và riêng tư trong một hệ thống kết nối. Dưới đây là tóm tắt các bước:</p>
<ul>
<li>
<p><strong>Cửa sổ 1</strong>: Gửi yêu cầu đặt tên là &ldquo;bob&rdquo; và nhận được phản hồi.</p>
</li>
<li>
<p><strong>Cửa sổ 2</strong>: Gửi yêu cầu đặt tên là &ldquo;alice&rdquo; và nhận được phản hồi tương tự.</p>
</li>
<li>
<p><strong>Quay lại cửa sổ 1</strong>: Kiểm tra và thấy thông báo phản hồi rằng tên &ldquo;alice&rdquo; đã được đặt ở cửa sổ 2.</p>
</li>
<li>
<p><strong>Cửa sổ 2</strong>: Gửi tin nhắn công khai &ldquo;Hello World!&rdquo;.</p>
</li>
<li>
<p><strong>Quay lại cửa sổ 1</strong>: Kiểm tra và thấy tin nhắn công khai từ cửa sổ 2.</p>
</li>
<li>
<p><strong>Cửa sổ 2</strong>: Gửi tin nhắn riêng tư với nội dung &ldquo;this is private&rdquo; cho &ldquo;bob&rdquo;.</p>
</li>
<li>
<p><strong>Quay lại cửa sổ 1</strong>: Kiểm tra và thấy tin nhắn riêng tư từ &ldquo;alice&rdquo;.</p>
</li>
<li>
<p><strong>Cửa sổ 2</strong>: Ngắt kết nối bằng cách dùng <code>Ctrl + C</code>.</p>
</li>
<li>
<p><strong>Cửa sổ 1</strong>: Nhận thông báo rằng kết nối ở cửa sổ 2 đã bị ngắt.</p>
</li>
</ul>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/lab3/2-lambda-function-code/" title="Mã hàm Lambda"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/lab3/4-cleaning-up/" title="Dọn dẹp tài nguyên" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1726994205"></script>
    <script src="/js/perfect-scrollbar.min.js?1726994205"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1726994205"></script>
    <script src="/js/jquery.sticky.js?1726994205"></script>
    <script src="/js/featherlight.min.js?1726994205"></script>
    <script src="/js/highlight.pack.js?1726994205"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1726994205"></script>
    <script src="/js/learn.js?1726994205"></script>
    <script src="/js/hugo-learn.js?1726994205"></script>

    <link href="/mermaid/mermaid.css?1726994205" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1726994205"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
